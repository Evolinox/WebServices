version: "3.8"
services:

  tracker-db:
    container_name: tracker-db
    image: mariadb:10.7
    ports:
      - "3401:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_PASSWORD=password
      - MYSQL_USER=user
      - MYSQL_DATABASE=tracker_db
    networks:
      - backend-network
    depends_on:
      - product-db
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost" ]
      interval: 5s
      retries: 5
      start_period: 5s
      timeout: 2s

  product-db:
    container_name: product-db
    image: mariadb:10.7
    ports:
      - "3402:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_PASSWORD=password
      - MYSQL_USER=user
      - MYSQL_DATABASE=product_db
    networks:
      - backend-network
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost" ]
      interval: 5s
      retries: 5
      start_period: 5s
      timeout: 2s

  calendar-db:
    container_name: calendar-db
    image: mariadb:10.7
    ports:
      - "3403:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_PASSWORD=password
      - MYSQL_USER=user
      - MYSQL_DATABASE=calendar_db
    networks:
      - backend-network
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost" ]
      interval: 5s
      retries: 5
      start_period: 5s
      timeout: 2s

  shoppingList-db:
    container_name: shoppingList-db
    image: mariadb:10.7
    ports:
      - "3404:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_PASSWORD=password
      - MYSQL_USER=user
      - MYSQL_DATABASE=shoppingList_db
    networks:
      - backend-network
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost" ]
      interval: 5s
      retries: 5
      start_period: 5s
      timeout: 2s

  product-api:
    container_name: product-api
    build:
      context: ./backend/productApi
      dockerfile: Dockerfile
    ports:
      - "9402:9402"
    depends_on:
      - product-db
    networks:
      - backend-network

  calendar-api:
    container_name: calendar-api
    build:
      context: ./backend/calendarApi
      dockerfile: Dockerfile
    ports:
      - "9403:9403"
    depends_on:
      - calendar-db
    networks:
      - backend-network

  shoppingList-api:
    container_name: shoppingList-api
    build:
      context: ./backend/shoppingListApi
      dockerfile: Dockerfile
    ports:
      - "9404:9404"
    depends_on:
      - shoppingList-db
    networks:
      - backend-network

  tracker-api:
    container_name: tracker-api
    build:
      context: ./backend/tracker
      dockerfile: Dockerfile
    ports:
      - "9401:9401"
    depends_on:
      - product-db
      - calendar-db
      - shoppingList-db
      - tracker-db
      - product-api
      - calendar-api
      - shoppingList-api
    networks:
      - backend-network
  frontend:
    container_name: frontend
    build:
      context: ./frontend
    ports:
      - "1420:1420"
    depends_on:
      - tracker-api
    networks:
      - backend-network
networks:
  backend-network:
    driver: bridge